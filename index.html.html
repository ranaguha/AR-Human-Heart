<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AR Human Heart</title>
  <!-- Model Viewer: loads WebXR/Scene Viewer/Quick Look for AR on supported devices -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <style>
    :root { --ui-bg: rgba(15,15,17,.72); --ui-txt:#fff; --accent:#34d399; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; background:#0b0d10; color:#eaeaea; }
    header { position:fixed; inset:16px auto auto 16px; z-index:10; background:var(--ui-bg); padding:10px 14px; border-radius:14px; box-shadow: 0 8px 30px rgba(0,0,0,.35); backdrop-filter: blur(8px); }
    header h1 { font-size:16px; margin:0; font-weight:700; letter-spacing:.2px; }
    header p { margin:4px 0 0; font-size:12px; opacity:.85 }

    model-viewer { width:100vw; height:100vh; --progress-bar-color: var(--accent); background: radial-gradient(1000px 600px at 50% 30%, #12151a, #0b0d10 55%); }
    .controls { position:fixed; right:16px; bottom:16px; display:flex; gap:10px; z-index:10; }
    .btn { border:none; background:var(--ui-bg); color:var(--ui-txt); padding:10px 12px; border-radius:14px; font-weight:600; cursor:pointer; box-shadow: 0 8px 30px rgba(0,0,0,.35); backdrop-filter: blur(8px); display:flex; align-items:center; gap:8px; }
    .btn[aria-pressed="true"]{ outline:2px solid var(--accent); }
    .btn:active{ transform: translateY(1px) }
    #arButton { position: fixed; left:16px; bottom:16px; }
    #hint { position:fixed; inset:auto 16px 70px auto; z-index:10; font-size:12px; opacity:.8 }
    .tag { position:fixed; top:16px; right:16px; background:#111; color:#bbb; padding:6px 10px; border-radius:999px; font-size:11px; letter-spacing:.3px; }
    .credit { position:fixed; left:16px; bottom:62px; font-size:11px; color:#a0a0a0; opacity:.9 }
    .hidden { display:none }
  </style>
</head>
<body>
  <header>
    <h1>Human Heart ‚Äî Interactive AR</h1>
    <p>Pinch to zoom ¬∑ drag to rotate ¬∑ two‚Äëfinger drag to pan</p>
  </header>
  <span class="tag">Web ¬∑ iOS ¬∑ Android</span>

  <!-- The 3D Viewer -->
  <model-viewer id="viewer"
    src="human_heart_3d_model.glb"
    ar
    ar-modes="webxr scene-viewer quick-look"
    ar-scale="auto"
    camera-controls
    auto-rotate
    autoplay
    exposure="1.0"
    shadow-intensity="1"
    interaction-prompt="when-focused"
    touch-action="pan-y"
    alt="3D model of a human heart">

    <!-- Custom AR button (shown on supported devices) -->
    <button slot="ar-button" id="arButton" class="btn" title="View in your space">
      üÖ∞Ô∏èüÖ° View in your space
    </button>

    <!-- Loading progress -->
    <div slot="progress-bar" style="width:100%; height:4px; background:rgba(255,255,255,.08);">
      <div id="pb" style="height:100%; width:0; background:var(--accent);"></div>
    </div>
  </model-viewer>

  <div class="controls">
    <button id="pulse" class="btn" aria-pressed="false" title="Toggle heartbeat animation">‚ù§Ô∏è Heartbeat</button>
    <button id="reset" class="btn" title="Reset view">‚Ü∫ Reset</button>
    <button id="wire" class="btn" aria-pressed="false" title="Toggle wireframe (if supported)"># Wire</button>
  </div>

  <div id="hint" class="hidden">Tip: In AR, move your phone to detect a surface. Tap to place.</div>
  <div class="credit">If AR doesn‚Äôt appear, your device/browser may not support WebXR.</div>

  <script>
    const mv = document.getElementById('viewer');
    const pb = document.getElementById('pb');

    // Simple progress bar
    mv.addEventListener('progress', (e) => {
      const { totalProgress } = e.detail;
      pb.style.width = `${Math.round(totalProgress * 100)}%`;
    });

    // Reset camera & scale
    document.getElementById('reset').addEventListener('click', () => {
      mv.cameraOrbit = '0deg 75deg 45%';
      mv.fieldOfView = '30deg';
      mv.zoom(1);
      mv.style.transform = 'scale(1)';
    });

    // Heartbeat pulse (CSS scale) ‚Äî toggle
    let pulsing = false, rafId = null, t0 = null;
    const pulseBtn = document.getElementById('pulse');
    pulseBtn.addEventListener('click', () => {
      pulsing = !pulsing;
      pulseBtn.setAttribute('aria-pressed', pulsing);
      if (!pulsing) { cancelAnimationFrame(rafId); mv.style.transform = 'scale(1)'; return; }
      t0 = performance.now();
      const bpm = 72; // change for faster/slower pulse
      const period = 60000 / bpm; // ms per beat
      const amp = 0.06; // pulse amplitude
      const animate = (t) => {
        const dt = (t - t0) % period;
        const phase = (dt / period) * Math.PI * 2;
        const scale = 1 + Math.max(0, Math.sin(phase)) * amp; // systole only
        mv.style.transform = `scale(${scale.toFixed(4)})`;
        rafId = requestAnimationFrame(animate);
      };
      rafId = requestAnimationFrame(animate);
    });

    // Wireframe toggle (best-effort via scene-graph, may not affect all materials)
    const wireBtn = document.getElementById('wire');
    let wired = false;
    wireBtn.addEventListener('click', async () => {
      await mv.updateComplete;
      const matList = mv.model?.materials || [];
      wired = !wired;
      wireBtn.setAttribute('aria-pressed', wired);
      for (const m of matList) {
        try { m.wireframe = wired; } catch (e) {}
      }
    });

    // AR usage hint
    mv.addEventListener('ar-status', (ev) => {
      const supported = ev.detail.status !== 'not-presenting';
      document.getElementById('hint').classList.toggle('hidden', !supported);
    });

    // Sensible initial view
    mv.cameraOrbit = '0deg 75deg 45%';
    mv.fieldOfView = '30deg';
  </script>
</body>
</html>
